# 🚀 Claude Relay Service 部署说明

## 📋 所需文件

只需要以下文件即可完成部署：
```
docker-compose.deploy.yml  # Docker编排配置
部署说明.md               # 本说明文件（可选）
```

## ⚡ 快速部署命令

```bash
# 1. 下载配置文件到服务器
wget https://raw.githubusercontent.com/your-repo/claude-relay-service/main/docker-compose.deploy.yml

# 2. 直接启动服务（所有配置已预设）
docker-compose -f docker-compose.deploy.yml up -d

# 3. 验证部署
curl http://localhost:9990/health
```

## 🌐 访问地址

- **主服务**: http://服务器IP:9990
- **Web管理界面**: http://服务器IP:9990/web  
- **API端点**: http://服务器IP:9990/api/v1/messages
- **健康检查**: http://服务器IP:9990/health

## 🔧 可选：包含Redis管理工具

```bash
# 启动服务 + Redis管理界面
docker-compose -f docker-compose.deploy.yml --profile tools up -d

# Redis管理界面：http://服务器IP:8081
# 用户名：admin  密码：admin123
```

## 📊 固定配置说明

所有配置已硬编码，无需修改：

- **端口**: 9990 (主服务), 6381 (Redis), 8081 (Redis管理)
- **JWT密钥**: 已预设32字符安全密钥
- **加密密钥**: 已预设32字符加密密钥
- **性能优化**: 已启用API Key缓存、响应压缩等
- **时区**: Asia/Shanghai
- **日志**: info级别，自动轮转

## 🛠️ 管理命令

```bash
# 查看状态
docker-compose -f docker-compose.deploy.yml ps

# 查看日志
docker-compose -f docker-compose.deploy.yml logs -f claude-relay

# 重启服务
docker-compose -f docker-compose.deploy.yml restart

# 停止服务
docker-compose -f docker-compose.deploy.yml down

# 更新到最新版本
docker-compose -f docker-compose.deploy.yml pull
docker-compose -f docker-compose.deploy.yml up -d
```

## 🔍 验证部署

```bash
# 1. 检查所有容器运行状态
docker-compose -f docker-compose.deploy.yml ps

# 2. 测试健康检查
curl http://localhost:9990/health

# 3. 测试Web界面
curl -I http://localhost:9990/web

# 4. 检查日志无错误
docker-compose -f docker-compose.deploy.yml logs claude-relay --tail=50
```

## 🚨 故障排除

### 端口被占用
```bash
# 检查端口占用情况
netstat -tlnp | grep 9990
# 或者修改docker-compose.deploy.yml中的端口映射
```

### 服务无法访问
```bash
# 检查防火墙
ufw allow 9990

# 检查Docker网络
docker network ls | grep claude-relay-deploy
```

### 查看错误日志
```bash
# 查看详细错误信息
docker-compose -f docker-compose.deploy.yml logs claude-relay
docker-compose -f docker-compose.deploy.yml logs redis-deploy
```

## 📈 性能特性

已启用的优化功能：
- ⚡ API Key验证缓存 (5分钟)
- 📦 响应内容压缩
- 🔧 Redis连接池优化 (2-20连接)
- 📊 实时性能监控
- 🛡️ 健康检查和自动重启

## ✅ 部署完成检查清单

- [ ] 容器全部启动 (`docker-compose ps`)
- [ ] 健康检查通过 (`curl http://localhost:9990/health`)
- [ ] Web界面可访问 (`curl -I http://localhost:9990/web`)
- [ ] Redis连接正常 (日志无Redis错误)
- [ ] 防火墙端口开放 (`ufw status`)

完成以上检查后，Claude Relay Service 即可正常使用！

---

**镜像版本**: luzhipeng728/claude-relay-service:latest  
**配置**: 所有参数已优化预设，开箱即用